import{d as p,j as m,k as Y,A as B,W as N,c as J,o as i,w as g,a as s,l as _,e as d,F as h,h as x,t as b,v as w,s as z,n as S,b as k,g as j,C as y}from"./app-BAsRu4FG.js";import{_ as E}from"./AppLayout-BJkIyiEt.js";import{_ as O}from"./PrimaryButton--d7rAwVm.js";import{_ as P}from"./TextInput-BRg-EK8C.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"p-4"},T={class:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-4"},W=["value"],L=["value"],q={class:"mt-4 overflow-x-auto"},G={class:"min-w-full border bg-white rounded-lg shadow-md"},H={class:"px-4 py-2"},K=["onUpdate:modelValue","onChange"],Q={class:"px-4 py-2"},X={class:"px-4 py-2"},Z={class:"px-4 py-2"},oe={__name:"Allocation",props:{transactions:Array,sources:Array,filters:Object},setup($){const n=$,u=p(n.filters.year||new Date().getFullYear().toString()),r=p(n.filters.month||(new Date().getMonth()+1).toString().padStart(2,"0")),o=p({}),c=p({}),V=m(()=>{const e=[];for(let l=2025;l<=2030;l++)e.push(l.toString());return e}),A=m(()=>[{value:"01",label:"Januari"},{value:"02",label:"Februari"},{value:"03",label:"Maret"},{value:"04",label:"April"},{value:"05",label:"Mei"},{value:"06",label:"Juni"},{value:"07",label:"Juli"},{value:"08",label:"Agustus"},{value:"09",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Desember"}]);Y(()=>{const a=`${u.value}-${r.value}`;o.value={},c.value={},n.transactions.forEach(t=>{t.date===a&&(o.value[t.source_id]=f(t.amount),c.value[t.source_id]=!0)})});const C=m(()=>n.sources);m(()=>{const a=`${u.value}-${r.value}`;return n.transactions.filter(t=>t.date===a)});const v=a=>c.value[a]!==void 0,D=a=>{const t=`${u.value}-${r.value}`,e=parseFloat(o.value[a].replace(/[^0-9.]/g,""));c.value[a]=e,y({source_id:a,amount:e,date:t}).post(route("allocation-in.store"),{onSuccess:()=>{n.transactions.push({id:Date.now(),source_id:a,amount:e,date:t,source:n.sources.find(l=>l.id===a)}),o.value[a]=f(e)}})},M=a=>{const t=`${u.value}-${r.value}`,e=n.transactions.find(l=>l.source_id===a&&l.date===t);if(!e){alert("Data tidak ditemukan.");return}y({}).delete(route("allocation-in.destroy",e.id),{onSuccess:()=>{const l=n.transactions.findIndex(U=>U.id===e.id);l!==-1&&n.transactions.splice(l,1),delete c.value[a],o.value[a]=""}})},F=a=>{y({is_active:a.is_active}).put(route("source_active",a.id))},f=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(a),I=(a,t)=>{const l=t.target.value.replace(/[^0-9.]/g,"");o.value[a]=l,t.target.value=f(l)};return B([u,r],([a,t])=>{N.get(route("allocation-in.index"),{year:a,month:t},{preserveState:!1})}),(a,t)=>(i(),J(E,{title:"Allocation Source"},{default:g(()=>[s("div",R,[s("div",T,[_(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),class:"border rounded px-4 py-2 w-full md:w-48"},[t[2]||(t[2]=s("option",{value:""},"Pilih Tahun",-1)),(i(!0),d(h,null,x(V.value,e=>(i(),d("option",{key:e,value:e},b(e),9,W))),128))],512),[[w,u.value]]),_(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),class:"border rounded px-4 py-2 w-full md:w-48"},[t[3]||(t[3]=s("option",{value:""},"Pilih Bulan",-1)),(i(!0),d(h,null,x(A.value,e=>(i(),d("option",{key:e.value,value:e.value},b(e.label),9,L))),128))],512),[[w,r.value]])]),s("div",q,[s("table",G,[t[4]||(t[4]=s("thead",{class:"bg-gray-200"},[s("tr",null,[s("th",{class:"px-4 py-2 text-left"},"Status"),s("th",{class:"px-4 py-2 text-left"},"Sumber"),s("th",{class:"px-4 py-2 text-left"},"Jumlah"),s("th",{class:"px-4 py-2 text-left"},"Aksi")])],-1)),s("tbody",null,[(i(!0),d(h,null,x(C.value,e=>(i(),d("tr",{key:e.id,class:"border-b hover:bg-gray-100"},[s("td",H,[_(s("input",{type:"checkbox","onUpdate:modelValue":l=>e.is_active=l,"true-value":1,"false-value":0,onChange:l=>F(e),class:"form-checkbox h-5 w-5 text-blue-600"},null,40,K),[[z,e.is_active]])]),s("td",Q,[s("span",{class:S({"text-red-500":!e.is_active})},b(e.name),3)]),s("td",X,[k(P,{modelValue:o.value[e.id],"onUpdate:modelValue":l=>o.value[e.id]=l,type:"text",class:"block w-full",disabled:v(e.id),onInput:l=>I(e.id,l)},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"])]),s("td",Z,[k(O,{onClick:l=>v(e.id)?M(e.id):D(e.id),class:S({"bg-green-600 hover:bg-green-700":!v(e.id),"bg-red-600 hover:bg-red-700":v(e.id)})},{default:g(()=>[j(b(v(e.id)?"Reset":"Simpan"),1)]),_:2},1032,["onClick","class"])])]))),128))])])])])]),_:1}))}};export{oe as default};
