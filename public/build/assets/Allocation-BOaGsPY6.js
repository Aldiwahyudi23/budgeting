import{d as p,j as m,k as Y,A as B,W as N,c as J,o as i,w as g,a as s,l as _,e as d,F as x,h,t as b,v as k,s as z,n as y,b as S,g as j,C as w}from"./app-BAsRu4FG.js";import{_ as E}from"./PrimaryButton--d7rAwVm.js";import{_ as O}from"./TextInput-BRg-EK8C.js";import{_ as P}from"./AppLayout-BJkIyiEt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"p-4"},T={class:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-4"},W=["value"],K=["value"],L={class:"mt-4 overflow-x-auto"},q={class:"min-w-full border bg-white rounded-lg shadow-md"},G={class:"px-4 py-2"},H=["onUpdate:modelValue","onChange"],Q={class:"px-4 py-2"},X={class:"px-4 py-2"},Z={class:"px-4 py-2"},oe={__name:"Allocation",props:{transactions:Array,categories:Array,filters:Object},setup($){const n=$,u=p(n.filters.year||new Date().getFullYear().toString()),r=p(n.filters.month||(new Date().getMonth()+1).toString().padStart(2,"0")),o=p({}),c=p({}),V=m(()=>{const e=[];for(let l=2025;l<=2030;l++)e.push(l.toString());return e}),C=m(()=>[{value:"01",label:"Januari"},{value:"02",label:"Februari"},{value:"03",label:"Maret"},{value:"04",label:"April"},{value:"05",label:"Mei"},{value:"06",label:"Juni"},{value:"07",label:"Juli"},{value:"08",label:"Agustus"},{value:"09",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Desember"}]);Y(()=>{const a=`${u.value}-${r.value}`;o.value={},c.value={},n.transactions.forEach(t=>{t.date===a&&(o.value[t.category_id]=f(t.amount),c.value[t.category_id]=!0)})});const A=m(()=>n.categories);m(()=>{const a=`${u.value}-${r.value}`;return n.transactions.filter(t=>t.date===a)});const v=a=>c.value[a]!==void 0,D=a=>{const t=`${u.value}-${r.value}`,e=parseFloat(o.value[a].replace(/[^0-9.]/g,""));c.value[a]=e,w({category_id:a,amount:e,date:t}).post(route("allocation-ex.store"),{onSuccess:()=>{n.transactions.push({id:Date.now(),category_id:a,amount:e,date:t,category:n.categories.find(l=>l.id===a)}),o.value[a]=f(e)}})},M=a=>{const t=`${u.value}-${r.value}`,e=n.transactions.find(l=>l.category_id===a&&l.date===t);if(!e){alert("Data tidak ditemukan.");return}w({}).delete(route("allocation-ex.destroy",e.id),{onSuccess:()=>{const l=n.transactions.findIndex(U=>U.id===e.id);l!==-1&&n.transactions.splice(l,1),delete c.value[a],o.value[a]=""}})},F=a=>{w({is_active:a.is_active}).put(route("category_active",a.id))},f=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(a),I=(a,t)=>{const l=t.target.value.replace(/[^0-9.]/g,"");o.value[a]=l,t.target.value=f(l)};return B([u,r],([a,t])=>{N.get(route("allocation-ex.index"),{year:a,month:t},{preserveState:!1})}),(a,t)=>(i(),J(P,{title:"Allocation"},{default:g(()=>[s("div",R,[s("div",T,[_(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),class:"border rounded px-4 py-2 w-full md:w-48"},[t[2]||(t[2]=s("option",{value:""},"Pilih Tahun",-1)),(i(!0),d(x,null,h(V.value,e=>(i(),d("option",{key:e,value:e},b(e),9,W))),128))],512),[[k,u.value]]),_(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),class:"border rounded px-4 py-2 w-full md:w-48"},[t[3]||(t[3]=s("option",{value:""},"Pilih Bulan",-1)),(i(!0),d(x,null,h(C.value,e=>(i(),d("option",{key:e.value,value:e.value},b(e.label),9,K))),128))],512),[[k,r.value]])]),s("div",L,[s("table",q,[t[4]||(t[4]=s("thead",{class:"bg-gray-200"},[s("tr",null,[s("th",{class:"px-4 py-2 text-left"},"Status"),s("th",{class:"px-4 py-2 text-left"},"Kategori"),s("th",{class:"px-4 py-2 text-left"},"Jumlah"),s("th",{class:"px-4 py-2 text-left"},"Aksi")])],-1)),s("tbody",null,[(i(!0),d(x,null,h(A.value,e=>(i(),d("tr",{key:e.id,class:"border-b hover:bg-gray-100"},[s("td",G,[_(s("input",{type:"checkbox","onUpdate:modelValue":l=>e.is_active=l,"true-value":1,"false-value":0,onChange:l=>F(e),class:"form-checkbox h-5 w-5 text-blue-600"},null,40,H),[[z,e.is_active]])]),s("td",Q,[s("span",{class:y({"text-red-500":!e.is_active})},b(e.name),3)]),s("td",X,[S(O,{modelValue:o.value[e.id],"onUpdate:modelValue":l=>o.value[e.id]=l,type:"text",class:"block w-full",disabled:v(e.id),onInput:l=>I(e.id,l)},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"])]),s("td",Z,[S(E,{onClick:l=>v(e.id)?M(e.id):D(e.id),class:y({"bg-green-600 hover:bg-green-700":!v(e.id),"bg-red-600 hover:bg-red-700":v(e.id)})},{default:g(()=>[j(b(v(e.id)?"Reset":"Simpan"),1)]),_:2},1032,["onClick","class"])])]))),128))])])])])]),_:1}))}};export{oe as default};
