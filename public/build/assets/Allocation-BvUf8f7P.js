import{d as v,k as m,m as j,j as _,W as E,c as O,o as r,w as S,a as l,p as x,e as d,F as h,h as g,t as f,v as $,x as Y,n as y,b as A,g as z,C as k}from"./app-BAijexpd.js";import{_ as L}from"./PrimaryButton-DOrKTp0i.js";import{_ as P}from"./TextInput-CaApGyw9.js";import{A as T}from"./AppLayout-DlFxLZi-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"p-4"},K={class:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-4"},R=["value"],q=["value"],G={class:"mt-4 overflow-x-auto"},H={class:"min-w-full border bg-white rounded-lg shadow-md"},I={class:"px-4 py-2"},Q=["onUpdate:modelValue","onChange"],X={class:"px-4 py-2"},Z={class:"px-4 py-2"},ee={class:"px-4 py-2"},ne={__name:"Allocation",props:{transactions:Array,categories:Array,filters:Object},setup(C){const o=C,u=v(o.filters.year||new Date().getFullYear().toString()),i=v(o.filters.month||(new Date().getMonth()+1).toString().padStart(2,"0")),n=v({}),c=v({}),V=v(Array.from({length:10},(a,t)=>new Date().getFullYear()-t)),D=m(()=>[{value:"01",label:"Januari"},{value:"02",label:"Februari"},{value:"03",label:"Maret"},{value:"04",label:"April"},{value:"05",label:"Mei"},{value:"06",label:"Juni"},{value:"07",label:"Juli"},{value:"08",label:"Agustus"},{value:"09",label:"September"},{value:"10",label:"Oktober"},{value:"11",label:"November"},{value:"12",label:"Desember"}]),w=()=>{const a=`${u.value}-${i.value}`;n.value={},c.value={},o.transactions.forEach(t=>{t.date===a&&(n.value[t.category_id]=b(t.amount),c.value[t.category_id]=!0)})};j(w),_([u,i],()=>{w()});const F=m(()=>o.categories);m(()=>{const a=`${u.value}-${i.value}`;return o.transactions.filter(t=>t.date===a)}),m(()=>{const a=`${u.value}-${i.value}`;return o.transactions.filter(t=>t.date===a).reduce((t,e)=>t+parseFloat(e.amount),0)});const p=a=>c.value[a]!==void 0,M=a=>{const t=`${u.value}-${i.value}`,e=parseFloat(n.value[a].replace(/[^0-9.]/g,""));c.value[a]=e,k({category_id:a,amount:e,date:t}).post(route("allocation-ex.store"),{onSuccess:()=>{o.transactions.push({id:Date.now(),category_id:a,amount:e,date:t,category:o.categories.find(s=>s.id===a)}),n.value[a]=b(e)}})},B=a=>{const t=`${u.value}-${i.value}`,e=o.transactions.find(s=>s.category_id===a&&s.date===t);if(!e){alert("Data tidak ditemukan.");return}k({}).delete(route("allocation-ex.destroy",e.id),{onSuccess:()=>{const s=o.transactions.findIndex(N=>N.id===e.id);s!==-1&&o.transactions.splice(s,1),delete c.value[a],n.value[a]=""}})},U=a=>{k({is_active:a.is_active}).put(route("category_active",a.id))};_([u,i],([a,t])=>{E.get(route("allocation-ex.index"),{year:a,month:t},{preserveState:!1})});const b=a=>a?a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."):"",J=(a,t)=>{let e=t.target.value.replace(/[^0-9]/g,"");n.value[a]=e,t.target.value=b(e)};return _(n,a=>{Object.keys(a).forEach(t=>{a[t]&&(n.value[t]=a[t])})},{deep:!0}),(a,t)=>(r(),O(T,{title:"Allocation"},{default:S(()=>[l("div",W,[l("div",K,[x(l("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),class:"border rounded px-4 py-2 w-full md:w-48"},[t[2]||(t[2]=l("option",{value:""},"Pilih Tahun",-1)),(r(!0),d(h,null,g(V.value,e=>(r(),d("option",{key:e,value:e},f(e),9,R))),128))],512),[[$,u.value]]),x(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),class:"border rounded px-4 py-2 w-full md:w-48"},[t[3]||(t[3]=l("option",{value:""},"Pilih Bulan",-1)),(r(!0),d(h,null,g(D.value,e=>(r(),d("option",{key:e.value,value:e.value},f(e.label),9,q))),128))],512),[[$,i.value]])]),l("div",G,[l("table",H,[t[4]||(t[4]=l("thead",{class:"bg-gray-200"},[l("tr",null,[l("th",{class:"px-4 py-2 text-left"},"Status"),l("th",{class:"px-4 py-2 text-left"},"Kategori"),l("th",{class:"px-4 py-2 text-left"},"Jumlah"),l("th",{class:"px-4 py-2 text-left"},"Aksi")])],-1)),l("tbody",null,[(r(!0),d(h,null,g(F.value,e=>(r(),d("tr",{key:e.id,class:"border-b hover:bg-gray-100"},[l("td",I,[x(l("input",{type:"checkbox","onUpdate:modelValue":s=>e.is_active=s,"true-value":1,"false-value":0,onChange:s=>U(e),class:"form-checkbox h-5 w-5 text-blue-600"},null,40,Q),[[Y,e.is_active]])]),l("td",X,[l("span",{class:y({"text-red-500":!e.is_active})},f(e.name),3)]),l("td",Z,[A(P,{modelValue:n.value[e.id],"onUpdate:modelValue":s=>n.value[e.id]=s,type:"text",class:"block w-full min-w-[150px]",disabled:p(e.id),onInput:s=>J(e.id,s)},null,8,["modelValue","onUpdate:modelValue","disabled","onInput"])]),l("td",ee,[A(L,{onClick:s=>p(e.id)?B(e.id):M(e.id),class:y({"bg-green-600 hover:bg-green-700":!p(e.id),"bg-red-600 hover:bg-red-700":p(e.id)})},{default:S(()=>[z(f(p(e.id)?"Reset":"Simpan"),1)]),_:2},1032,["onClick","class"])])]))),128))])])])])]),_:1}))}};export{ne as default};
